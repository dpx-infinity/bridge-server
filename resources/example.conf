common {
    discovery-ports 32768 32769 32770
    present-services true
}

peers {
    discover on lo eth0 wlan0
    static {
        peer tcp://tplex.cu.cc:16128
    }
}

communicators {
    communicator local {
        listen on tcp://127.0.0.1:16128
        listen on tcp://[::1]:16128
        listen on unix:///run/bridge/socket
    }
    communicator remote {
        listen on tcp://1.2.3.4:16129
        listen on tcp://[1:2:3::4]:16129
    }
}

repo {
    load {
        name echo
        location "${BRIDGE_LIB}/plugins/echo.gel"
    }
    load {
        name echo
        location "${BRIDGE_LIB}/plugins/chat.gel"
    }
    load {
        name logger
        location "${BRIDGE_LIB}/plugins/logger.gel"
    }
}

plugins {
    plugin echo-instance {
        type echo

        set prefix "Echo: "
    }

    plugin chat-instance {
        type chat
    }

    plugin logger-instance {
        type logger

        set output stdout
    }
}

links {
    #         socket       peer                socket        peer
    connect { socket io at plugin chat } with { socket io at communicator local }
    connect { socket io at plugin chat } with { socket io at communicator remote }

    connect { socket io at plugin echo } with { socket io at communicator local }

    connect { socket io at plugin chat } with { socket input at plugin logger }

    connect { log at plugin echo } with { input at plugin logger }
    connect { log at plugin chat } with { input at plugin logger }
}
